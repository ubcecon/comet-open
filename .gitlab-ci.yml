stages:
  - build
  - test
  - deploy

jupyter-build:
  stage: build
  image: python:slim
  script:
    - pip install -U jupyter-book
    - jupyter-book clean comet-home/
    - jupyter-book build comet-home/
  artifacts:
    paths:
      - comet-home/_build/

production:
  stage: deploy
  image: busybox:latest
  script:
    - mv comet-home/_build/html public
  artifacts:
    paths:
      - public
  when: manual
  rules:
    - if: '$CI_COMMIT_BRANCH == "pages"'
  environment:
    name: production
    url: https://comet.arts.ubc.ca



test:
    stage: test
    image: busybox:latest
    script:
        - mkdir public/$CI_COMMIT_BRANCH
        - mv comet-home/_build/html public/$CI_COMMIT_BRANCH
    artifacts:
        paths:
            - public
        expire_in: 1 days
    when: manual
    environment:
      name: testing
      url: https://comet.arts.ubc.ca