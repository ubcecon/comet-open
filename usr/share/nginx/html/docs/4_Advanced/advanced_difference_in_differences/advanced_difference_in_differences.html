<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="This note introducing difference-in-difference style models, particularly for causal models and inference.">

<title>COMET - 3.1.1 - Advanced - Linear Differencing Models I</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../docs/4_Advanced/advanced_geospatial/advanced_geospatial.html" rel="next">
<link href="../../../docs/4_Advanced/advanced_classification_and_clustering/advanced_classification_and_clustering.html" rel="prev">
<link href="../../../media/comet_favicon.png" rel="icon" type="image/png">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<meta name="keywords" content="economics, econometrics, R, data, machine learning, UBC, COMET, geog 374, econ 325, econ 326, learning, teaching, learn r, r help, help, tutorial, r tutorial for beginners,learning statistics with r, learn r programming, learn statistics, linear regression, r machine learning, learn machine learning, university of british columbia, british columbia, r programming for beginners, r language tutorial, r tutorial for beginners, economic data, econometrics tutoring, economics help for students, economics homework help, oer resources for teachers, open educational resources for teachers, educational resource, oer project, oer materials, oer resources, learn economics online, learn econometrics, teach yourself economics, teach yourself econometrics, econometrics basics for beginners">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../media/logo_no_tiny_text.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">COMET</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-get-started" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Get Started</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-get-started">    
        <li>
    <a class="dropdown-item" href="../../../pages/quickstart.html" rel="" target="">
 <span class="dropdown-text">Quickstart Guide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../pages/installation/installing_locally.html" rel="" target="">
 <span class="dropdown-text">Install and Use COMET</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../pages/index/index_getting_started.html" rel="" target="">
 <span class="dropdown-text">Get Started</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-learn-by-skill-level" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Learn By Skill Level</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-learn-by-skill-level">    
        <li>
    <a class="dropdown-item" href="../../../pages/index/index_getting_started.html" rel="" target="">
 <span class="dropdown-text">Getting Started</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../pages/index/index_beginner.html" rel="" target="">
 <span class="dropdown-text">Beginner</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../pages/index/index_intermediate.html" rel="" target="">
 <span class="dropdown-text">Intermediate - Econometrics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../pages/index/index_geog.html" rel="" target="">
 <span class="dropdown-text">Intermediate - Geospatial</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../pages/index/index_advanced.html" rel="" target="">
 <span class="dropdown-text">Advanced</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="../../../pages/index/all.html" rel="" target="">
 <span class="dropdown-text">Browse All</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-learn-by-class" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Learn By Class</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-learn-by-class">    
        <li>
    <a class="dropdown-item" href="../../../pages/index/index_226.html" rel="" target="">
 <span class="dropdown-text">Making Sense of Economic Data (ECON 226/227)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../pages/index/index_325.html" rel="" target="">
 <span class="dropdown-text">Econometrics I (ECON 325)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../pages/index/index_326.html" rel="" target="">
 <span class="dropdown-text">Econometrics II (ECON 326)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../pages/index/index_geog.html" rel="" target="">
 <span class="dropdown-text">Statistics in Geography (GEOG 374)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-learn-to-research" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Learn to Research</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-learn-to-research">    
        <li>
    <a class="dropdown-item" href="../../../pages/index/index_research.html" rel="" target="">
 <span class="dropdown-text">Learn How to Do a Project</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-teach-with-comet" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Teach With COMET</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-teach-with-comet">    
        <li>
    <a class="dropdown-item" href="../../../pages/teaching_with_comet.html" rel="" target="">
 <span class="dropdown-text">Learn how to teach with Jupyter and COMET</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../pages/using_comet.html" rel="" target="">
 <span class="dropdown-text">Using COMET in the Classroom</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../pages/dissemination/dissemination.html" rel="" target="">
 <span class="dropdown-text">See COMET presentations</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-contribute" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Contribute</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-contribute">    
        <li>
    <a class="dropdown-item" href="../../../pages/installation/installing_for_development.html" rel="" target="">
 <span class="dropdown-text">Install for Development</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../pages/documentation/writing_self_tests.html" rel="" target="">
 <span class="dropdown-text">Write Self Tests</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-launch-comet" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-play" role="img">
</i> 
 <span class="menu-text">Launch COMET</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-launch-comet">    
        <li>
    <a class="dropdown-item" href="https://open.jupyter.ubc.ca/jupyter/hub/user-redirect/git-pull?repo=https%3A%2F%2Fgithub.com%2Fubcecon%2Fcomet-notebooks&amp;urlpath=lab%2Ftree%2Fcomet-notebooks%2F&amp;branch=main" rel="" target=""><i class="bi bi-cloud-check" role="img">
</i> 
 <span class="dropdown-text">Launch on JupyterOpen (with Data)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://open.jupyter.ubc.ca/jupyter/hub/user-redirect/git-pull?repo=https%3A%2F%2Fgithub.com%2Fubcecon%2Fcomet-project&amp;urlpath=lab%2Ftree%2Fcomet-project%2F&amp;branch=main" rel="" target=""><i class="bi bi-cloud-check" role="img">
</i> 
 <span class="dropdown-text">Launch on JupyterOpen (lite)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://ubc.syzygy.ca/jupyter/hub/user-redirect/git-pull?repo=https%3A%2F%2Fgithub.com%2Fubcecon%2Fcomet-project&amp;urlpath=lab%2Ftree%2Fcomet-project%2F&amp;branch=main" rel="" target=""><i class="bi bi-gear" role="img">
</i> 
 <span class="dropdown-text">Launch on Syzygy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://colab.research.google.com/github/ubcecon/comet-notebooks/blob/main/" rel="" target=""><i class="bi bi-google" role="img">
</i> 
 <span class="dropdown-text">Launch on Colab</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ubcecon/comet-notebooks/archive/refs/heads/main.zip" rel="" target=""><i class="bi bi-cloud-download" role="img">
</i> 
 <span class="dropdown-text">Launch Locally</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="https://github.com/ubcecon/comet-open/archive/refs/heads/datasets.zip" rel="" target=""><i class="bi bi-clipboard-data" role="img">
</i> 
 <span class="dropdown-text">Project Datasets</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/ubcecon/comet-open" rel="" target="">
 <span class="dropdown-text">Github Repository</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../#" rel="" target="">
 <span class="menu-text">|</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-about" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">About</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-about">    
        <li>
    <a class="dropdown-item" href="../../../pages/team.html" rel="" target="">
 <span class="dropdown-text">COMET Team</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../pages/copyright.html" rel="" target="">
 <span class="dropdown-text">Copyright Information</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../pages/index/index_advanced.html">Advanced Modules</a></li><li class="breadcrumb-item"><a href="../../../docs/4_Advanced/advanced_difference_in_differences/advanced_difference_in_differences.html">Differences In Differences</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
 <span class="menu-text"><h4>Learn by Skill Level</h4></span>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../pages/index/index_getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started: Introduction to Data, R, and Econometrics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/1_Getting_Started/getting_started_intro_to_jupyter/getting_started_intro_to_jupyter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to JupyterNotebooks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/1_Getting_Started/getting_started_intro_to_r/getting_started_intro_to_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/1_Getting_Started/getting_started_intro_to_data/getting_started_intro_to_data1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to Data (Part 1)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/1_Getting_Started/getting_started_intro_to_data/getting_started_intro_to_data2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to Data (Part 2)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../pages/index/index_beginner.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Beginner: Using R and Data in Applied Econometrics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/2_Beginner/beginner_intro_to_statistics1/beginner_intro_to_statistics1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Statistics I</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/2_Beginner/beginner_intro_to_statistics2/beginner_intro_to_statistics2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Statistics II</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/2_Beginner/beginner_central_tendency/beginner_central_tendency.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Central Tendency</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/2_Beginner/beginner_dispersion_and_dependence/beginner_dispersion_and_dependence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dispersion and Dependence</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/2_Beginner/beginner_confidence_intervals/beginner_confidence_intervals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Confidence Intervals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/2_Beginner/beginner_hypothesis_testing/beginner_hypothesis_testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hypothesis Testing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/2_Beginner/beginner_intro_to_data_visualization1/beginner_intro_to_data_visualization1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Visualization I</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/2_Beginner/beginner_intro_to_data_visualization2/beginner_intro_to_data_visualization2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Visualization II</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/2_Beginner/beginner_distributions/beginner_distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/2_Beginner/beginner_sampling_distributions/beginner_sampling_distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampling Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/3_Intermediate/intermediate_intro_to_regression/intermediate_intro_to_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Regression</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../pages/index/index_intermediate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intermediate: Econometrics and Modeling Using R</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/3_Intermediate/intermediate_intro_to_regression/intermediate_intro_to_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/3_Intermediate/intermediate_multiple_regression/intermediate_multiple_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/3_Intermediate/intermediate_issues_in_regression/intermediate_issues_in_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Issues in Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/3_Intermediate/intermediate_interactions_and_nonlinear_terms/intermediate_interactions_and_nonlinear_terms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interactions</span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../pages/index/index_geog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geographic Computation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/3_Intermediate/geog_374/Lab_05_Chisquare/Lab_05_Chisquare.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chi-Square Test</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/3_Intermediate/geog_374/Lab_06_Ttest/Lab_06_Ttest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">t-test</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/3_Intermediate/geog_374/Lab_02_ANOVA/Lab_02_ANOVA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ANOVA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/3_Intermediate/geog_374/Lab_03_Regression/Lab_03_Regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/3_Intermediate/geog_374/Climate_Disasters/Climate_Disasters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Wrangling and Visualizing Data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../pages/index/index_advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Modules</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/4_Advanced/advanced_classification_and_clustering/advanced_classification_and_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Classification and Clustering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/4_Advanced/advanced_difference_in_differences/advanced_difference_in_differences.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Differences In Differences</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/4_Advanced/advanced_geospatial/advanced_geospatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geospatial I</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/4_Advanced/advanced_geospatial/advanced_geospatial_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Geospatial II</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/4_Advanced/advanced_instrumental_variables/advanced_instrumental_variables1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Instrumental Variables I</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/4_Advanced/advanced_instrumental_variables/advanced_instrumental_variables2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Instrumental Variables II</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/4_Advanced/advanced_llm_apis2/advanced_llm_apis2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Large Language Model APIs (Python)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/4_Advanced/advanced_linear_differencing/advanced_linear_differencing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Differencing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/4_Advanced/advanced_ollama_llm/fine_tuning_llm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Training LLMS</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/4_Advanced/advanced_sentiment_analysis/sentiment_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sentiment Analysis Using LLMs (Python)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/4_Advanced/advanced_transcription/advanced_transcription_whisper.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transcription (Python)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/4_Advanced/advanced_vocalization/advanced_vocalization_draft.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vocalization (Python)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/4_Advanced/advanced_word_embeddings/advanced_word_embeddings_python_version.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Word Embeddings (Python)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/4_Advanced/advanced_word_embeddings/advanced_word_embeddings_r_version.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Word Embeddings (R)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/4_Advanced/advanced_panel_data/advanced_panel_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Panel Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../docs/4_Advanced/advanced_synthetic_control/advanced_synthetic_control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Synthetic Controls</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#difference-in-differences" id="toc-difference-in-differences" class="nav-link active" data-scroll-target="#difference-in-differences">Difference-in-Differences</a>
  <ul class="collapse">
  <li><a href="#generating-panel-structured-data" id="toc-generating-panel-structured-data" class="nav-link" data-scroll-target="#generating-panel-structured-data">Generating Panel-Structured Data</a></li>
  <li><a href="#summary-statistics" id="toc-summary-statistics" class="nav-link" data-scroll-target="#summary-statistics">Summary Statistics</a></li>
  </ul></li>
  <li><a href="#difference-in-differences-estimator" id="toc-difference-in-differences-estimator" class="nav-link" data-scroll-target="#difference-in-differences-estimator">Difference-in-Differences Estimator</a>
  <ul class="collapse">
  <li><a href="#difference-in-differences-with-t-tests" id="toc-difference-in-differences-with-t-tests" class="nav-link" data-scroll-target="#difference-in-differences-with-t-tests">Difference-in-Differences with <span class="math inline">\(t\)</span>-Tests</a></li>
  <li><a href="#interpreting-the-results" id="toc-interpreting-the-results" class="nav-link" data-scroll-target="#interpreting-the-results">Interpreting the Results</a></li>
  <li><a href="#naïve-comparison-measure-estimator" id="toc-naïve-comparison-measure-estimator" class="nav-link" data-scroll-target="#naïve-comparison-measure-estimator">Naïve Comparison Measure Estimator</a></li>
  <li><a href="#naïve-before-after-estimator" id="toc-naïve-before-after-estimator" class="nav-link" data-scroll-target="#naïve-before-after-estimator">Naïve Before-After Estimator</a></li>
  <li><a href="#naïve-linear-estimator-without-interaction-terms" id="toc-naïve-linear-estimator-without-interaction-terms" class="nav-link" data-scroll-target="#naïve-linear-estimator-without-interaction-terms">Naïve Linear Estimator Without Interaction Terms</a></li>
  <li><a href="#difference-in-differences-using-linear-regression" id="toc-difference-in-differences-using-linear-regression" class="nav-link" data-scroll-target="#difference-in-differences-using-linear-regression">Difference-in-Differences using Linear Regression</a></li>
  <li><a href="#comparing-estimators" id="toc-comparing-estimators" class="nav-link" data-scroll-target="#comparing-estimators">Comparing Estimators</a></li>
  </ul></li>
  <li><a href="#heterogeneity-over-time-the-event-study-estimator" id="toc-heterogeneity-over-time-the-event-study-estimator" class="nav-link" data-scroll-target="#heterogeneity-over-time-the-event-study-estimator">Heterogeneity Over Time: the Event Study Estimator</a>
  <ul class="collapse">
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load Data</a></li>
  <li><a href="#wrongly-using-the-difference-in-differences-estimator" id="toc-wrongly-using-the-difference-in-differences-estimator" class="nav-link" data-scroll-target="#wrongly-using-the-difference-in-differences-estimator">Wrongly Using the Difference-in-Differences Estimator</a></li>
  <li><a href="#event-study-with-t-tests" id="toc-event-study-with-t-tests" class="nav-link" data-scroll-target="#event-study-with-t-tests">Event Study with <span class="math inline">\(t\)</span>-Tests</a></li>
  <li><a href="#interpreting-the-results-1" id="toc-interpreting-the-results-1" class="nav-link" data-scroll-target="#interpreting-the-results-1">Interpreting the Results</a></li>
  <li><a href="#event-study-with-linear-regression" id="toc-event-study-with-linear-regression" class="nav-link" data-scroll-target="#event-study-with-linear-regression">Event Study with Linear Regression</a></li>
  </ul></li>
  <li><a href="#heterogeneity-over-groups-the-triple-difference-estimator" id="toc-heterogeneity-over-groups-the-triple-difference-estimator" class="nav-link" data-scroll-target="#heterogeneity-over-groups-the-triple-difference-estimator">Heterogeneity Over Groups: the Triple Difference Estimator</a>
  <ul class="collapse">
  <li><a href="#load-data-1" id="toc-load-data-1" class="nav-link" data-scroll-target="#load-data-1">Load Data</a></li>
  <li><a href="#wrongly-using-the-difference-in-differences-estimator-1" id="toc-wrongly-using-the-difference-in-differences-estimator-1" class="nav-link" data-scroll-target="#wrongly-using-the-difference-in-differences-estimator-1">Wrongly Using the Difference-in-Differences Estimator</a></li>
  <li><a href="#triple-difference-intuition-with-t-tests" id="toc-triple-difference-intuition-with-t-tests" class="nav-link" data-scroll-target="#triple-difference-intuition-with-t-tests">Triple Difference Intuition with <span class="math inline">\(t\)</span>-Tests</a></li>
  <li><a href="#triple-difference-with-linear-regression" id="toc-triple-difference-with-linear-regression" class="nav-link" data-scroll-target="#triple-difference-with-linear-regression">Triple Difference with Linear Regression</a></li>
  <li><a href="#comparing-misspecified-estimators-under-triple-differences" id="toc-comparing-misspecified-estimators-under-triple-differences" class="nav-link" data-scroll-target="#comparing-misspecified-estimators-under-triple-differences">Comparing Misspecified Estimators under Triple Differences</a></li>
  </ul></li>
  <li><a href="#using-repeated-cross-section-data" id="toc-using-repeated-cross-section-data" class="nav-link" data-scroll-target="#using-repeated-cross-section-data">Using Repeated Cross-Section Data</a>
  <ul class="collapse">
  <li><a href="#generating-repeated-cross-section-data" id="toc-generating-repeated-cross-section-data" class="nav-link" data-scroll-target="#generating-repeated-cross-section-data">Generating Repeated Cross-Section Data</a></li>
  <li><a href="#did-on-repeated-cross-section-using-ols" id="toc-did-on-repeated-cross-section-using-ols" class="nav-link" data-scroll-target="#did-on-repeated-cross-section-using-ols">DID on Repeated Cross-Section using OLS</a></li>
  <li><a href="#did-using-a-2-times-2-table" id="toc-did-using-a-2-times-2-table" class="nav-link" data-scroll-target="#did-using-a-2-times-2-table">DID using a <span class="math inline">\(2 \times 2\)</span> Table</a></li>
  <li><a href="#compute-the-2-times-2-table-of-means" id="toc-compute-the-2-times-2-table-of-means" class="nav-link" data-scroll-target="#compute-the-2-times-2-table-of-means">Compute the <span class="math inline">\(2 \times 2\)</span> Table of Means</a></li>
  <li><a href="#compute-the-variances-associated-with-each-group" id="toc-compute-the-variances-associated-with-each-group" class="nav-link" data-scroll-target="#compute-the-variances-associated-with-each-group">Compute the Variances Associated with each Group</a></li>
  <li><a href="#compute-the-counts-in-each-group" id="toc-compute-the-counts-in-each-group" class="nav-link" data-scroll-target="#compute-the-counts-in-each-group">Compute the Counts in each Group</a></li>
  <li><a href="#compute-the-test-statistic" id="toc-compute-the-test-statistic" class="nav-link" data-scroll-target="#compute-the-test-statistic">Compute the Test Statistic</a></li>
  <li><a href="#compute-the-p-value" id="toc-compute-the-p-value" class="nav-link" data-scroll-target="#compute-the-p-value">Compute the <span class="math inline">\(p\)</span>-Value</a></li>
  <li><a href="#comparison-against-linear-regression" id="toc-comparison-against-linear-regression" class="nav-link" data-scroll-target="#comparison-against-linear-regression">Comparison Against Linear Regression</a></li>
  <li><a href="#summary-for-repeated-cross-section" id="toc-summary-for-repeated-cross-section" class="nav-link" data-scroll-target="#summary-for-repeated-cross-section">Summary for Repeated Cross-Section</a></li>
  </ul></li>
  <li><a href="#when-parallel-trends-fails" id="toc-when-parallel-trends-fails" class="nav-link" data-scroll-target="#when-parallel-trends-fails">When Parallel Trends Fails</a>
  <ul class="collapse">
  <li><a href="#load-data-2" id="toc-load-data-2" class="nav-link" data-scroll-target="#load-data-2">Load Data</a></li>
  <li><a href="#the-t-test-fails" id="toc-the-t-test-fails" class="nav-link" data-scroll-target="#the-t-test-fails">The <span class="math inline">\(t\)</span>-Test Fails</a></li>
  <li><a href="#the-regression-method-still-works" id="toc-the-regression-method-still-works" class="nav-link" data-scroll-target="#the-regression-method-still-works">The Regression Method Still Works</a></li>
  </ul></li>
  <li><a href="#exercise-difference-in-differences-in-your-project" id="toc-exercise-difference-in-differences-in-your-project" class="nav-link" data-scroll-target="#exercise-difference-in-differences-in-your-project">Exercise #: Difference-in-Differences in your Project</a>
  <ul class="collapse">
  <li><a href="#load-your-data" id="toc-load-your-data" class="nav-link" data-scroll-target="#load-your-data">Load Your Data</a></li>
  <li><a href="#plan-and-run-some-dd-models" id="toc-plan-and-run-some-dd-models" class="nav-link" data-scroll-target="#plan-and-run-some-dd-models">Plan and Run some DD Models</a></li>
  <li><a href="#tabulate-all-models" id="toc-tabulate-all-models" class="nav-link" data-scroll-target="#tabulate-all-models">Tabulate All Models</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/ubcecon/comet-open/issues/new" class="toc-action">Report an issue</a></p></div></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="advanced_difference_in_differences.ipynb" download="advanced_difference_in_differences.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">3.1.1 - Advanced - Linear Differencing Models I</h1>
  <div class="quarto-categories">
    <div class="quarto-category">advanced</div>
    <div class="quarto-category">R</div>
    <div class="quarto-category">difference in differences</div>
    <div class="quarto-category">t-test</div>
    <div class="quarto-category">comparison measure estimator</div>
    <div class="quarto-category">before-after estimator</div>
    <div class="quarto-category">regression</div>
    <div class="quarto-category">triple difference estimator</div>
    <div class="quarto-category">cross-section data</div>
    <div class="quarto-category">parallel trends</div>
  </div>
  </div>

<div>
  <div class="description">
    This note introducing difference-in-difference style models, particularly for causal models and inference.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>This notebook will cover:</p>
<ol type="1">
<li>Difference-in-Differences and when it is appropriate.</li>
<li>Consequences of misspecification.</li>
<li>The Event Study estimator.</li>
<li>The Triple Difference estimator.</li>
<li>Using Repeated Cross-Section data.</li>
<li>Failure of Parallel Trends.</li>
</ol>
<p>This notebook assumes you are familiar with and draws on concepts covered in:</p>
<ol type="1">
<li>Introduction to Jupyter.</li>
<li>Introduction to R.</li>
<li>Introduction to Data.</li>
<li>Expectations and Summary Statistics.</li>
<li>Conditional Expectations and the <span class="math inline">\(t\)</span>-Test.</li>
<li>Regression Analysis.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="difference-in-differences" class="level2">
<h2 class="anchored" data-anchor-id="difference-in-differences">Difference-in-Differences</h2>
<p>To demonstrate how DID works and the consequences of misspecification, we require data where we know the true parameter values. Therefore this again necessitates using simulated data rather than real-life data.</p>
<section id="generating-panel-structured-data" class="level3">
<h3 class="anchored" data-anchor-id="generating-panel-structured-data">Generating Panel-Structured Data</h3>
<p>Panel-Structured data have both a unit and a time index. Additionally, there should be a common time trend component and an additional time trend component specific only to the “treated” group. For our purposes, it can be more helpful to think of the “treated” group as simply the “group of interest” who may have been differentially affected by something that changed between the “before” and the “after” period(s). The minimum number of time periods we need to run a DID estimator is <span class="math inline">\(2\)</span>, but the definition of a “period” is not constrained to “usual” time units like months and years. For example, if we have the privilege of working with linked census data, then our period may be decadal or quinquennial, while if we work with stock market data our period may be as fine as minutes or seconds.</p>
<p>Note also that panel-structured data is not restricted to a unit-by-time structure. It is also possible to have a group-by-unit panel structured data. Examples include twins in a family unit, students in a class, patients and their primary physicians, <em>et cetera</em>. In this case, <code>i</code> below indexes the group instead of the unit and <code>T</code> indexes the unit within the group instead of time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">998</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">i =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>), <span class="at">hgt =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="fl">1.68</span>, <span class="fl">0.09</span>), <span class="at">u =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">diet =</span> <span class="fu">if_else</span>(<span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Treatment =</span> <span class="dv">0</span>, <span class="at">e =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wgt =</span> <span class="dv">28</span> <span class="sc">*</span> hgt <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> e),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Treatment =</span> <span class="dv">1</span>, <span class="at">e =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wgt =</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">28</span> <span class="sc">*</span> hgt <span class="sc">^</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">3</span> <span class="sc">*</span> diet <span class="sc">+</span> e)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summary-statistics" class="level3">
<h3 class="anchored" data-anchor-id="summary-statistics">Summary Statistics</h3>
<p>Let’s first take a quick overview of the simulated data. This dataset tries to simulate a height and weight dataset. <code>hgt</code> is short for height (measured in meters; m), <code>wgt</code> for weight (measured in kilograms; kg), <code>diet</code> implies we are considering the effect of a diet. As is intuitive, evaluating the effect of a diet is an appropriate case for DID because diets take time to show their effects. We also clearly need height as a control because all else equal, a healthy but taller person should weigh more than a healthy but shorter person. <code>i</code> and <code>T</code> are our person and time indexes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sim.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="difference-in-differences-estimator" class="level2">
<h2 class="anchored" data-anchor-id="difference-in-differences-estimator">Difference-in-Differences Estimator</h2>
<p>The DID estimator looks as follows. We estimate</p>
<p><span class="math display">\[
    \theta = \mathbb{E}[Y_{i} \mid \underbrace{G_{i} = 1, T_{i} = 1}_{D_{i} = 1}] - \mathbb{E}[Y_{i} \mid \underbrace{G_{i} = 1, T_{i} = 0}_{D_{i} = 0}].
\]</span></p>
<p>This is a model for when we have a treatment implemented in between two periods where we observe the units. However, as before, there will be bias without further adjustments to the method. The main bias with estimators that make use of the temporal dimension of the data is that naïve estimators conflate the true effect with time trends.</p>
<p>To give an intuition, suppose we want to measure the effect of drinking milk daily on height growth in young children. The problem is that young children are developing and naturally grow taller regardless of their diet (unless they are severely malnourished). Therefore, a naïve estimator conflates this natural time trend with the real effect of the target diet and can spuriously estimate a positive effect of drinking milk when it could very well be the case that the true effect is zero or even negative.</p>
<p>Mathematically, we see the bias in the potential-outcomes model by</p>
<p><span class="math display">\[
    \theta = \underbrace{\mathbb{E}[Y_{1,i}(1) \mid T_{i} = 1] - \mathbb{E}[Y_{1,i}(0) \mid T_{i} = 1]}_{ATET} + \underbrace{\mathbb{E}[Y_{1,i}(0) \mid T_{i} = 1] - \mathbb{E}[Y_{1,i}(0) \mid T_{i} = 0]}_{Bias}.
\]</span></p>
<p>The bias is clearly coming from the unobserved time trend. How do we deal with it given that the comparison estimator already implicitly makes use of a time period indicator? The answer is that we postulate the existence of a counterfactual group for which we do indeed observe them being untreated in both periods, but their time trend is identical to the group of interest:</p>
<p><span class="math display">\[
    \mathbb{E}[Y_{0,i}(0) \mid T_{i} = 1] - \mathbb{E}[Y_{0,i}(0) \mid T_{i} = 0] = \mathbb{E}[Y_{1,i}(0) \mid T_{i} = 1] - \mathbb{E}[Y_{1,i}(0) \mid T_{i} = 0]
\]</span></p>
<p>where</p>
<p><span class="math display">\[
    \mathbb{E}[Y_{0,i}(0) \mid T_{i} = 1] - \mathbb{E}[Y_{0,i}(0) \mid T_{i} = 0] = \mathbb{E}[Y_{i} \mid \underbrace{G_{i} = 0, T_{i} = 1}_{D_{i} = 0}] - \mathbb{E}[Y_{i} \mid \underbrace{G_{i} = 0, T_{i} = 0}_{D_{i} = 0}].
\]</span></p>
<p>With this observed control group we can now estimate:</p>
<p><span class="math display">\[
    ATET = \left( \mathbb{E}[Y_{i} \mid G_{i} = 1, T_{i} = 1] - \mathbb{E}[Y_{i} \mid G_{i} = 1, T_{i} = 0] \right) - \left( \mathbb{E}[Y_{i} \mid G_{i} = 0, T_{i} = 1] - \mathbb{E}[Y_{i} \mid G_{i} = 0, T_{i} = 0] \right).
\]</span></p>
<p>This is estimatable because all this data is observed.</p>
<section id="difference-in-differences-with-t-tests" class="level3">
<h3 class="anchored" data-anchor-id="difference-in-differences-with-t-tests">Difference-in-Differences with <span class="math inline">\(t\)</span>-Tests</h3>
<p>Before we talk about the regression method of estimating DID models, let’s talk about the much simpler method of doing a plain comparison estimate. Recall that the model is</p>
<p><span class="math display">\[
    ATET = \left( \mathbb{E}[Y_{i} \mid G_{i} = 1, T_{i} = 1] - \mathbb{E}[Y_{i} \mid G_{i} = 1, T_{i} = 0] \right) - \left( \mathbb{E}[Y_{i} \mid G_{i} = 0, T_{i} = 1] - \mathbb{E}[Y_{i} \mid G_{i} = 0, T_{i} = 0] \right)
\]</span></p>
<p>which we can rewrite as</p>
<p><span class="math display">\[
    ATET = \mathbb{E}[Y_{i,1} - Y_{i,0} \mid G_{i} = 1] - \mathbb{E}[Y_{i,1} - Y_{i,0} \mid G_{i} = 0].
\]</span></p>
<p>This tells us precisely how to estimate the Average Treatment Effect on the Treated (ATET) using the DID estimator using a simple <span class="math inline">\(t\)</span>-test:</p>
<ol type="1">
<li>Generate <span class="math inline">\(\Delta Y_{i} = Y_{i,1} - Y_{i,0}\)</span>.</li>
<li>Test <span class="math inline">\(\overline{\Delta Y_{i}} \mid_{G_{i} = 1}\)</span> versus <span class="math inline">\(\overline{\Delta Y_{i}} \mid_{G_{i} = 0}\)</span>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>diff.data <span class="ot">&lt;-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">diet =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">t.test</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        diff.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(diet <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        diff.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(diet <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">var.equal =</span> <span class="cn">TRUE</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_df</span>(tidy) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    print</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="interpreting-the-results" class="level3">
<h3 class="anchored" data-anchor-id="interpreting-the-results">Interpreting the Results</h3>
<p>Recall that the simple <span class="math inline">\(t\)</span>-test method does not use controls, so this level of accuracy is unexpected. Note, in general, the DID estimator without controls does not yield the same results as the DID estimator with controls when applied to real-world data.</p>
<p>The estimate is simply interpreted as the estimated ATET. The diet decreases the weight of the group undertaking the diet by <span class="math inline">\(2.97\)</span> kg. In your own cases, what the treatment, outcome, treated group, and units are depends on your question and data.</p>
</section>
<section id="naïve-comparison-measure-estimator" class="level3">
<h3 class="anchored" data-anchor-id="naïve-comparison-measure-estimator">Naïve Comparison Measure Estimator</h3>
<p>Let’s first look several wrong ways to use panel data and show empirically why we should not be doing these things if our interest is in the ATET. One way is to estimate a comparison measure for the “after” period only:</p>
<p><span class="math display">\[
    \theta_{after} = \mathbb{E}[Y_{i} \mid \underbrace{G_{i} = 1, T_{i} = 1}_{D_{i} = 1}] - \mathbb{E}[Y_{i} \mid \underbrace{G_{i} = 0, T_{i} = 1}_{D_{i} = 0}].
\]</span></p>
<p>This is of course going to be biased because you can see that, in the potential-outcomes model, this corresponds to</p>
<p><span class="math display">\[
    \theta_{after} = \underbrace{\mathbb{E}[Y_{1,i}(1) \mid T_{i} = 1] - \mathbb{E}[Y_{1,i}(0) \mid T_{i} = 1]}_{ATET} + \underbrace{\mathbb{E}[Y_{1,i}(0) \mid T_{i} = 1] - \mathbb{E}[Y_{0,i}(0) \mid T_{i} = 1]}_{Bias}.
\]</span></p>
<p>This corresponds to the selection bias as we have been studying it for much of this course. However, if we assume that the size of this bias remains constant throughout time—which intuitively is exactly what the parallel trends assumption says—then we get rid of the selection bias precisely by further subtracting the “before” period comparison measure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>        wgt <span class="sc">~</span> hgt <span class="sc">+</span> diet,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> <span class="fu">filter</span>(sim.data, Treatment <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="naïve-before-after-estimator" class="level3">
<h3 class="anchored" data-anchor-id="naïve-before-after-estimator">Naïve Before-After Estimator</h3>
<p>The second wrong way to estimate a DID is to do exactly what was described at the start of this section,</p>
<p><span class="math display">\[
    \theta = \mathbb{E}[Y_{i} \mid \underbrace{G_{i} = 1, T_{i} = 1}_{D_{i} = 1}] - \mathbb{E}[Y_{i} \mid \underbrace{G_{i} = 1, T_{i} = 0}_{D_{i} = 0}].
\]</span></p>
<p>Of course, by now you know where the problem with this estimator lies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> <span class="fu">filter</span>(sim.data, diet <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="naïve-linear-estimator-without-interaction-terms" class="level3">
<h3 class="anchored" data-anchor-id="naïve-linear-estimator-without-interaction-terms">Naïve Linear Estimator Without Interaction Terms</h3>
<p>A third way to estimate the ATET wrongly is to do a naïve linear estimator of the form</p>
<p><span class="math display">\[
    Y_{i} = b_{0} + b_{1} T_{i} + b_{2} D_{i} + e_{i}.
\]</span></p>
<p>Why would this be biased? One way to think about this is that this regression implies</p>
<p><span class="math display">\[\begin{align*}
    b_{2} &amp; = \mathbb{E}[Y_{i} \mid D_{i} = 1, T_{i} = 1] - \mathbb{E}[Y_{i} \mid D_{i} = 0, T_{i} = 1] \\
    &amp; = \mathbb{E}[Y_{i} \mid D_{i} = 1, T_{i} = 0] - \mathbb{E}[Y_{i} \mid D_{i} = 0, T_{i} = 0] \\
    &amp; = \mathbb{E}[Y_{i} \mid D_{i} = 1] - \mathbb{E}[Y_{i} \mid D_{i} = 0] \\
    &amp; = \mathbb{E}[Y_{1,i}(1)] - \mathbb{E}[Y_{0,i}(0)] \\
    &amp; = \underbrace{\mathbb{E}[Y_{1,i}(1)] - \mathbb{E}[Y_{1,i}(0)]}_{ATET} + \underbrace{\mathbb{E}[Y_{1,i}(0)] - \mathbb{E}[Y_{0,i}(0)]}_{Bias}.
\end{align*}\]</span></p>
<p>This points to a selection bias intuition. If you believe there is no unobserved selection into treatment, then this model is correct. In most cases this is not true.</p>
<p>This may then prompt the question: intuitively, the saturated model solves this problem. Why? The idea again goes back to the parallel trends assumption. We assume that the selection bias is constant over time. As such, the “before” period observation where both groups are untreated provides an estimate of the selection bias, which we can then remove from this biased estimator to obtain the unbiased estimate of the ATET.</p>
<p>This intuition should also reveal something very interesting: the DID estimator circumvents selection bias entirely. You do not need an experimental set-up without selection bias to use DID!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">+</span> diet,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> sim.data</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="difference-in-differences-using-linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="difference-in-differences-using-linear-regression">Difference-in-Differences using Linear Regression</h3>
<p>The linear regression model of DID is how most DID models are estimated in the academic literature. We estimate a model that is saturated in the time and group variables,</p>
<p><span class="math display">\[
    Y_{i} = \alpha + \gamma T_{i} + \beta G_{i} + \delta T_{i} \times G_{i} + \epsilon_{i}.
\]</span></p>
<p>This gives us</p>
<p><span class="math display">\[\begin{align*}
    \mathbb{E}[Y_{i} \mid T_{i} = 1, G_{i} = 1] &amp; = \alpha + \gamma + \beta + \delta \\
    \mathbb{E}[Y_{i} \mid T_{i} = 1, G_{i} = 0] &amp; = \alpha + \gamma \\
    \mathbb{E}[Y_{i} \mid T_{i} = 0, G_{i} = 1] &amp; = \alpha + \beta \\
    \mathbb{E}[Y_{i} \mid T_{i} = 0, G_{i} = 0] &amp; = \alpha.
\end{align*}\]</span></p>
<p>This yields the time trend as <span class="math inline">\(\gamma\)</span> and the time-invariant selection bias as <span class="math inline">\(\beta\)</span>. <span class="math inline">\(\delta\)</span> is the unbiased estimator of the ATET and our parameter of interest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">*</span> diet,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> sim.data</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="comparing-estimators" class="level3">
<h3 class="anchored" data-anchor-id="comparing-estimators">Comparing Estimators</h3>
<p>The following table shows all the mispecified models and the correct specification. (1) is the naïve comparison estimator, (2) is the before-after estimator, (3) is the linear model estimator without the interaction term, (4) is the fully specified model, and (5) is what the <span class="math inline">\(t\)</span>-test implicitly estimates.</p>
<p>Again, note that (4) and (5) will in general not produce the same ATET estimate in most real-world data sets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> diet, <span class="at">data =</span> <span class="fu">filter</span>(sim.data, Treatment <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment, <span class="at">data =</span> <span class="fu">filter</span>(sim.data, diet <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">+</span> diet, <span class="at">data =</span> sim.data)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>model4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">*</span> diet, <span class="at">data =</span> sim.data)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>model5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> Treatment <span class="sc">*</span> diet, <span class="at">data =</span> sim.data)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(model1, </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>          model2, </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>          model3, </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>          model4, </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>          model5, </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">'text'</span>,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">df =</span> <span class="cn">FALSE</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">omit.stat =</span> <span class="fu">c</span>(<span class="st">'F'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="heterogeneity-over-time-the-event-study-estimator" class="level2">
<h2 class="anchored" data-anchor-id="heterogeneity-over-time-the-event-study-estimator">Heterogeneity Over Time: the Event Study Estimator</h2>
<p>The logic of DID can be extended to the case where we observe multiple post-treatment periods. If we think that the ATET is heterogeneous over time, we can estimate an ATET for each period observed. This gives rise to the Event Study estimator. It is so named because this is often used to study the effect of a specific event—usually policy changes and natural disasters—and trace out its effects over many periods. While there is currently an active literature looking at problems with this estimator, we concern ourselves primarily with the simplest case where the treatment occurs only once and we observe the treated group and a counterfactual never-treated group for several periods before and after the event.</p>
<section id="load-data" class="level3">
<h3 class="anchored" data-anchor-id="load-data">Load Data</h3>
<p>By convention, for a panel-structured data with more than two periods, period <span class="math inline">\(0\)</span> is when the treatment is implemented and all other period numbers refer to the number of periods after (positive) and before (negative) treatment implementation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">999</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">i =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>), <span class="at">hgt =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="fl">1.68</span>, <span class="fl">0.09</span>), <span class="at">u =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">diet =</span> <span class="fu">if_else</span>(<span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Treatment =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">e =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wgt =</span> <span class="sc">-</span> <span class="fl">1.2</span> <span class="sc">+</span> <span class="dv">28</span> <span class="sc">*</span> hgt <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> e),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Treatment =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">e =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wgt =</span> <span class="sc">-</span> .<span class="dv">5</span> <span class="sc">+</span> <span class="dv">28</span> <span class="sc">*</span> hgt <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> e),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Treatment =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">e =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wgt =</span> <span class="dv">28</span> <span class="sc">*</span> hgt <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> e),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Treatment =</span> <span class="dv">0</span>, <span class="at">e =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wgt =</span> .<span class="dv">3</span> <span class="sc">+</span> <span class="dv">28</span> <span class="sc">*</span> hgt <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">1.2</span> <span class="sc">*</span> diet <span class="sc">+</span> e),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Treatment =</span> <span class="dv">1</span>, <span class="at">e =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wgt =</span> .<span class="dv">5</span> <span class="sc">+</span> <span class="dv">28</span> <span class="sc">*</span> hgt <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> .<span class="dv">8</span> <span class="sc">*</span> diet <span class="sc">+</span> e),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Treatment =</span> <span class="dv">2</span>, <span class="at">e =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wgt =</span> .<span class="dv">9</span> <span class="sc">+</span> <span class="dv">28</span> <span class="sc">*</span> hgt <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> .<span class="dv">1</span> <span class="sc">*</span> diet <span class="sc">+</span> e),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Treatment =</span> <span class="dv">3</span>, <span class="at">e =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wgt =</span> <span class="fl">1.1</span> <span class="sc">+</span> <span class="dv">28</span> <span class="sc">*</span> hgt <span class="sc">^</span> <span class="dv">2</span> <span class="sc">-</span> .<span class="dv">5</span> <span class="sc">*</span> diet <span class="sc">+</span> e),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Treatment =</span> <span class="dv">4</span>, <span class="at">e =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wgt =</span> <span class="fl">1.4</span> <span class="sc">+</span> <span class="dv">28</span> <span class="sc">*</span> hgt <span class="sc">^</span> <span class="dv">2</span> <span class="sc">-</span> <span class="fl">1.5</span> <span class="sc">*</span> diet <span class="sc">+</span> e)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="wrongly-using-the-difference-in-differences-estimator" class="level3">
<h3 class="anchored" data-anchor-id="wrongly-using-the-difference-in-differences-estimator">Wrongly Using the Difference-in-Differences Estimator</h3>
<p>Intuitively, of course the plain DID estimator is a misspecification if we believe that the ATET is heterogeneous over time. Using the Law of Iterated Expectations, we know what the wrongly estimated ATET will be:</p>
<p><span class="math display">\[
    \mathbb{E}[\Delta_{i} \mid G_{i} = 1] = \mathbb{E}_{T}[\mathbb{E}[\Delta_{i} \mid G_{i} = 1, T] \mid G_{i} = 1].
\]</span></p>
<p>Hence, as in this simulated data set, if the time trend of the treatment effect is not monotonic, we can have unexpected results by incorrectly specifying a case of truly heterogeneous treatment effects using the homogeneous treatment effect estimator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sim.data <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">T =</span> <span class="fu">if_else</span>(Treatment <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">*</span> diet, <span class="at">data =</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="event-study-with-t-tests" class="level3">
<h3 class="anchored" data-anchor-id="event-study-with-t-tests">Event Study with <span class="math inline">\(t\)</span>-Tests</h3>
<p>The <span class="math inline">\(t\)</span>-Test version of the Event Study estimator is straightforward. What we are essentially interested in is</p>
<p><span class="math display">\[
    ATET(t) = \left( \mathbb{E}[Y_{i} \mid G_{i} = 1, T_{i} = t] - \mathbb{E}[Y_{i} \mid G_{i} = 1, T_{i} = -1] \right) - \left( \mathbb{E}[Y_{i} \mid G_{i} = 0, T_{i} = t] - \mathbb{E}[Y_{i} \mid G_{i} = 0, T_{i} = -1] \right)
\]</span></p>
<p>which we can rewrite as</p>
<p><span class="math display">\[
    ATET(t) = \mathbb{E}[Y_{i,t} - Y_{i,-1} \mid G_{i} = 1] - \mathbb{E}[Y_{i,t} - Y_{i,-1} \mid G_{i} = 0].
\]</span></p>
<p>This implies that what we want to do is simply to first restrict our data set to the periods <span class="math inline">\(t\)</span> and <span class="math inline">\(-1\)</span>, then use the regular DID estimator on this subset, and repeat this exercise for all periods before and after <span class="math inline">\(-1\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span> (t) <span class="fu">t.test</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>            sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> t <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt) <span class="sc">-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt), </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>            sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> t <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt) <span class="sc">-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt), </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">var.equal =</span> <span class="cn">TRUE</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_df</span>(tidy) <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    print</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="interpreting-the-results-1" class="level3">
<h3 class="anchored" data-anchor-id="interpreting-the-results-1">Interpreting the Results</h3>
<p>The <span class="math inline">\(t\)</span>-test analogue of the Event Study estimator also highlights intuitively how we need to think about and interpret the estimator. The ATET estimate for each period is interpreted with respect to the base period, which in this case is the period just before the treatment is implemented. Here,</p>
<ol type="1">
<li>The diet actually increases the weight of those on the diet by <span class="math inline">\(1.12\)</span> kg on average in the period they start the diet.</li>
<li>The diet still increases the weight of those on the diet by <span class="math inline">\(0.748\)</span> kg on average relative to before starting the diet after <span class="math inline">\(1\)</span> period (let’s say, months).</li>
<li>The effect of the diet <span class="math inline">\(2\)</span> months after starting the diet is approximately zero relative to before the diet.</li>
<li>The effect of the diet turns negative after <span class="math inline">\(3\)</span> months relative to before the diet, with those on diet losing <span class="math inline">\(0.571\)</span> kg on average.</li>
<li>Those on the diet lose <span class="math inline">\(1.55\)</span> kg on average after <span class="math inline">\(4\)</span> months on the diet relative to before starting the diet.</li>
</ol>
</section>
<section id="event-study-with-linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="event-study-with-linear-regression">Event Study with Linear Regression</h3>
<p>With linear regression, the Event Study method is even simpler. Factorise your time variable and set <span class="math inline">\(-1\)</span> as the base level using <code>relevel</code>, then estimate the model. <code>R</code> takes care of all the necessary interactions for us.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>sim.data <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Treatment =</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(Treatment, <span class="at">levels =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)), <span class="at">ref =</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">*</span> diet, <span class="at">data =</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="heterogeneity-over-groups-the-triple-difference-estimator" class="level2">
<h2 class="anchored" data-anchor-id="heterogeneity-over-groups-the-triple-difference-estimator">Heterogeneity Over Groups: the Triple Difference Estimator</h2>
<p>Suppose we are interested in not only the ATET, but also how the ATET differs across certain groups of interest. An example is whether a certain policy, which only affects some individuals, helps to close the gender wage gap: what this implicitly asks is whether</p>
<p><span class="math display">\[
    ATET(female) &gt; ATET(male).
\]</span></p>
<p>Provided that we have panel data, again there is a method that helps to illuminate this kind of heterogeneity: the Triple Difference estimator. What the Triple Difference estimator is interested in is implicitly</p>
<p><span class="math display">\[
    ATET(k) = \left( \mathbb{E}[Y_{i} \mid G_{i} = 1, K = k, T_{i} = 1] - \mathbb{E}[Y_{i} \mid G_{i} = 1, K = k, T_{i} = 0] \right) - \left( \mathbb{E}[Y_{i} \mid G_{i} = 0, K = k, T_{i} = 1] - \mathbb{E}[Y_{i} \mid G_{i} = 0, K = k, T_{i} = 0] \right),
\]</span></p>
<p>where <span class="math inline">\(k\)</span> is a group of interest that is not the basis for selection into treatment for which we think <span class="math inline">\(ATET(k) \ne ATET\)</span> and we would like to estimate <span class="math inline">\(ATET(k)\)</span> specifically. As in the lecture notes, while we can in principle estimate heterogeneous treatment effects by simply estimating a DID model for each sub-group, this assumes a fully heterogeneous model where it may not actually be warranted, is inefficient as you are not using the full sample, and it is difficult—though not impossible, but the methods are beyond this level of study—to test if the differences are actually statistically significant.</p>
<p>Hence, taking the usual route of adding yet another interaction term to the model to obtain the heterogeneous treatment effects of interest yields the Triple Differences estimator. This gives an intuition as to what Triple Differences are good for:</p>
<ol type="1">
<li>Triple Differences tells you if a treatment has additional effects on specific sub-groups.</li>
<li>Triple Differences is also useful if what you are interested in is the pure effect of the treatment and would like to partial out all other confounding effects of time and group using an argument similar to the parallel trends assumption.</li>
</ol>
<section id="load-data-1" class="level3">
<h3 class="anchored" data-anchor-id="load-data-1">Load Data</h3>
<p>The data requirements for Triple Differences are similar to that of DID, except we also require another grouping axis that exhibits variation over the treatment assignment indicator. In other words, it cannot be the case that that grouping variable is collinear with the treatment assignment indicator—for example, if we want to understand the gendered impact of a policy, that policy cannot only impact one gender.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">999</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">i =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>), <span class="at">u =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u, <span class="at">diet =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">diet =</span> <span class="fu">if_else</span>(diet <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">sex =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(sex <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">'male'</span>, <span class="st">'female'</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'male'</span>, <span class="st">'female'</span>)))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">hgt =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="fl">1.69</span>, .<span class="dv">1</span>))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Treatment =</span> <span class="dv">0</span>), sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Treatment =</span> <span class="dv">1</span>)) </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">e =</span> <span class="fu">rnorm</span>(<span class="dv">20000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wgt =</span> <span class="fl">26.4</span> <span class="sc">*</span> hgt <span class="sc">*</span> hgt <span class="sc">+</span> <span class="fl">1.7</span> <span class="sc">*</span> Treatment <span class="sc">-</span> <span class="fl">2.55</span> <span class="sc">*</span> (sex <span class="sc">==</span> <span class="st">'female'</span>) <span class="sc">-</span> <span class="fl">1.3</span> <span class="sc">*</span> Treatment <span class="sc">*</span> (sex <span class="sc">==</span> <span class="st">'female'</span>) <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> Treatment <span class="sc">*</span> diet <span class="sc">-</span> <span class="fl">1.2</span> <span class="sc">*</span> Treatment <span class="sc">*</span> diet <span class="sc">*</span> (sex <span class="sc">==</span> <span class="st">'female'</span>) <span class="sc">+</span> e) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="wrongly-using-the-difference-in-differences-estimator-1" class="level3">
<h3 class="anchored" data-anchor-id="wrongly-using-the-difference-in-differences-estimator-1">Wrongly Using the Difference-in-Differences Estimator</h3>
<p>The Law of Iterated Expectations can again be used to tell us that if the treatment effect is really heterogeneous, then ignoring that heterogeneity is going to yield a biased estimator that is the weighted mean of all the treatment effects,</p>
<p><span class="math display">\[
    \mathbb{E}[\Delta_{i} \mid G_{i} = 1] = \mathbb{E}_{K}[\mathbb{E}[\Delta_{i} \mid G_{i} = 1, K] \mid G_{i} = 1].
\]</span></p>
<p>In this case, it may look like there was a mistake because <span class="math inline">\(-2.5\)</span> is less than either <span class="math inline">\(-2\)</span> or <span class="math inline">\(-1.2\)</span>, but recall from the module on regressions that the proper way to interpret coefficients under interaction terms tells us that in fact the effect of the diet on the two sexes are <span class="math inline">\(-2\)</span> and <span class="math inline">\(-3.2\)</span> respectively. Therefore the biased estimate of <span class="math inline">\(-2.5\)</span> adheres to the Law of Iterated Expectations well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>sim.data <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">*</span> diet, <span class="at">data =</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="triple-difference-intuition-with-t-tests" class="level3">
<h3 class="anchored" data-anchor-id="triple-difference-intuition-with-t-tests">Triple Difference Intuition with <span class="math inline">\(t\)</span>-Tests</h3>
<p>Before we move into regression analysis, which can be harder to interpret, we’ll look at some <span class="math inline">\(t\)</span>-test results to get a bearing on the intuitions. Each row corresponds to one of the sexes. The first column of the table is the heterogeneous weight loss estimate of each sex. Then, the Triple Difference estimator is simply the difference in the two weight loss estimates. The estimate corresponds to the coefficient on the triple interaction term in our data simulation code, as expected, and can be interpreted in one of two ways. The first is outlined in the notes, corresponding to the true treatment effect after separating out group effects as well. The second is outlined here, corresponding to the additional weight loss due to the diet on females compared to males.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">t.test</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>        sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">'female'</span> <span class="sc">&amp;</span> Treatment <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt) <span class="sc">-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">'female'</span> <span class="sc">&amp;</span> Treatment <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt), </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">'female'</span> <span class="sc">&amp;</span> Treatment <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt) <span class="sc">-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">'female'</span> <span class="sc">&amp;</span> Treatment <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt), </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">var.equal =</span> <span class="cn">TRUE</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">t.test</span>(</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>        sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">'male'</span> <span class="sc">&amp;</span> Treatment <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt) <span class="sc">-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">'male'</span> <span class="sc">&amp;</span> Treatment <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt), </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">'male'</span> <span class="sc">&amp;</span> Treatment <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt) <span class="sc">-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">'male'</span> <span class="sc">&amp;</span> Treatment <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt), </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">var.equal =</span> <span class="cn">TRUE</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_df</span>(tidy) <span class="sc">%&gt;%</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    print</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="triple-difference-with-linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="triple-difference-with-linear-regression">Triple Difference with Linear Regression</h3>
<p>This shows the Triple Difference estimator as discussed in the note. In <code>R</code>, the interaction operator <code>*</code> can be chained and therefore it is relatively simple to set up the Triple Difference estimator. <code>R</code> takes care of populating all the interaction terms.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sim.data <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> sex <span class="sc">*</span> Treatment <span class="sc">*</span> diet, <span class="at">data =</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="comparing-misspecified-estimators-under-triple-differences" class="level3">
<h3 class="anchored" data-anchor-id="comparing-misspecified-estimators-under-triple-differences">Comparing Misspecified Estimators under Triple Differences</h3>
<p>The following two tables shows how various ways of misspecifying the model when the true CEF corresponds to the heterogeneous ATET/Triple Difference case results in biased estimates. Try to figure out if you can compute the biased estimates theoretically to check your understanding of how the DID model works in general!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">*</span> diet, <span class="at">data =</span> sim.data)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">*</span> diet, <span class="at">data =</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">'female'</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">*</span> diet, <span class="at">data =</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sex <span class="sc">==</span> <span class="st">'male'</span>))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>model4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">*</span> diet <span class="sc">*</span> sex, <span class="at">data =</span> sim.data)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(model1, </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>          model2, </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>          model3, </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>          model4, </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">'text'</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">df =</span> <span class="cn">FALSE</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">omit.stat =</span> <span class="fu">c</span>(<span class="st">'F'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">*</span> sex, <span class="at">data =</span> sim.data)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">*</span> sex, <span class="at">data =</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(diet <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">*</span> sex, <span class="at">data =</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(diet <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>model4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> diet <span class="sc">*</span> sex, <span class="at">data =</span> sim.data)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>model5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> diet <span class="sc">*</span> sex, <span class="at">data =</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>model6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> diet <span class="sc">*</span> sex, <span class="at">data =</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>model7 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">*</span> diet <span class="sc">*</span> sex, <span class="at">data =</span> sim.data)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(model1, </span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>          model2, </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>          model3, </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>          model4, </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>          model5, </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>          model6, </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>          model7, </span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">'text'</span>,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">df =</span> <span class="cn">FALSE</span>,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">omit.stat =</span> <span class="fu">c</span>(<span class="st">'F'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="using-repeated-cross-section-data" class="level2">
<h2 class="anchored" data-anchor-id="using-repeated-cross-section-data">Using Repeated Cross-Section Data</h2>
<p>Let’s return to the DID model for a bit.</p>
<p><span class="math display">\[
    ATET = \left( \mathbb{E}[Y_{i} \mid G_{i} = 1, T_{i} = 1] - \mathbb{E}[Y_{i} \mid G_{i} = 1, T_{i} = 0] \right) - \left( \mathbb{E}[Y_{i} \mid G_{i} = 0, T_{i} = 1] - \mathbb{E}[Y_{i} \mid G_{i} = 0, T_{i} = 0] \right).
\]</span></p>
<p>Nothing in this equation indicates that the individuals at <span class="math inline">\(T = 1\)</span> have to be the same as the individuals at <span class="math inline">\(T = 0\)</span>. The implication is that it is possible to do DID with repeated cross-section data. Recall that repeated cross-section data is simply data where you have collected data from samples in multiple periods, but the sample in each period is a different sample. Unlike panel data, where you have a time index in the data, there are no longitudinal observations at the unit level.</p>
<p>The model in theory suggests two ways to run DID.</p>
<section id="generating-repeated-cross-section-data" class="level3">
<h3 class="anchored" data-anchor-id="generating-repeated-cross-section-data">Generating Repeated Cross-Section Data</h3>
<p>Data for repeated cross-section data is similar to panel data, except that instead of generating the unit first and then reusing the units over time you simply generate a new set of units in each time period.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1000</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">i =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>), <span class="at">Treatment =</span> <span class="dv">0</span>, <span class="at">hgt =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="fl">1.68</span>, <span class="fl">0.09</span>), <span class="at">u =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>)),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">i =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>), <span class="at">Treatment =</span> <span class="dv">1</span>, <span class="at">hgt =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="fl">1.68</span>, <span class="fl">0.09</span>), <span class="at">u =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">diet =</span> <span class="fu">if_else</span>(<span class="fu">rnorm</span>(<span class="dv">20000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">e =</span> <span class="fu">rnorm</span>(<span class="dv">20000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wgt =</span> <span class="dv">2</span> <span class="sc">*</span> T <span class="sc">+</span> <span class="dv">28</span> <span class="sc">*</span> hgt <span class="sc">^</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">3</span> <span class="sc">*</span> T <span class="sc">*</span> diet <span class="sc">+</span> e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="did-on-repeated-cross-section-using-ols" class="level3">
<h3 class="anchored" data-anchor-id="did-on-repeated-cross-section-using-ols">DID on Repeated Cross-Section using OLS</h3>
<p>This is straightforward. As long as the samples in each period are independent, representative samples and you know which group in the “before” period would be given the treatment if you could observe them in the “after” period, then DID using OLS works the same way as in the panel data case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>sim.data <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">*</span> diet, <span class="at">data =</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="did-using-a-2-times-2-table" class="level3">
<h3 class="anchored" data-anchor-id="did-using-a-2-times-2-table">DID using a <span class="math inline">\(2 \times 2\)</span> Table</h3>
<p>The <span class="math inline">\(2 \times 2\)</span> table is:</p>
<table class="table">
<colgroup>
<col style="width: 21%">
<col style="width: 26%">
<col style="width: 26%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;"></th>
<th style="text-align: center;"><span class="math inline">\(G = 0\)</span></th>
<th style="text-align: center;"><span class="math inline">\(G = 1\)</span></th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">\(T = 0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu_{Y}(0,0)\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu_{Y}(1,0)\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu_{Y}(1,0) - \mu_{Y}(0,0)\)</span></td>
</tr>
<tr class="even">
<td style="text-align: right;"><span class="math inline">\(T = 1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu_{Y}(0,1)\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu_{Y}(1,1)\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu_{Y}(1,1) - \mu_{Y}(0,1)\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: right;"></td>
<td style="text-align: center;"><span class="math inline">\(\mu_{Y}(0,1) - \mu_{Y}(0,0)\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mu_{Y}(1,1) - \mu_{Y}(1,0)\)</span></td>
<td style="text-align: center;"><span class="math inline">\(ATET\)</span></td>
</tr>
</tbody>
</table>
<p>The principal problem is not in the point estimates. These are straightforward. The estimates for the central four cells are simply the four conditional means of the outcome variable. The estimates for the marginal cells are simply either row-wise or column-wise differences between the conditional means and the estimate of the ATET is the DID estimator using the conditional mean estimates in place of the true conditional expectations.</p>
<p>The main problem is, how do we know that the ATET estimate is statistically significant? In other words, we want to test</p>
<p><span class="math display">\[\begin{align*}
    H_{0} &amp; : \left( \mu_{Y}(1,1) - \mu_{Y}(1,0) \right) - \left( \mu_{Y}(0,1) - \mu_{Y}(0,0) \right) = 0 \\
    H_{1} &amp; : \left( \mu_{Y}(1,1) - \mu_{Y}(1,0) \right) - \left( \mu_{Y}(0,1) - \mu_{Y}(0,0) \right) \ne 0.
\end{align*}\]</span></p>
<p>Recall the following:</p>
<p><span class="math display">\[
    Var(\overline{X} + \overline{Y}) = Var(\overline{X}) + Var(\overline{Y}) + 2 Cov(\overline{X},\overline{Y}).
\]</span></p>
<p>Note that this switching of notation from <span class="math inline">\(\mu\)</span> (representing the true population-level conditional expectation) to <span class="math inline">\(\overline{X}\)</span> (representing our sample analogue estimator of the population-level expectations) is not a mistake. <span class="math inline">\(\mu\)</span> has a variance of zero because it is the true population parameter. On the other hand <span class="math inline">\(\overline{X}\)</span> has a variance because it is a function of a random sample. A function of random variables is itself a random variable (think about adding two random variables—is it now non-random?), therefore it makes sense to talk about its distributional properties. Now, if the data for <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are independent, then</p>
<p><span class="math display">\[
    Var(\overline{X} + \overline{Y}) = Var(\overline{X}) + Var(\overline{Y}).
\]</span></p>
<p>If the data was collected well, in many cases we can assume that <span class="math inline">\(\overline{Y}\mid_{G=0,T=0}\)</span>, <span class="math inline">\(\overline{Y}\mid_{G=0,T=1}\)</span>, <span class="math inline">\(\overline{Y}\mid_{G=1,T=0}\)</span>, and <span class="math inline">\(\overline{Y}\mid_{G=1,T=1}\)</span>, are indeed independent, which then implies that the SE of the estimator should just be</p>
<p><span class="math display">\[
    SE\left( \left( \overline{Y}\mid_{G=1,T=1} - \overline{Y}\mid_{G=1,T=0} \right) - \left( \overline{Y}\mid_{G=0,T=1} - \overline{Y}\mid_{G=0,T=0} \right) \right) = \sqrt{ Var\left(\overline{Y}\mid_{G=0,T=0}\right) + Var\left(\overline{Y}\mid_{G=0,T=1}\right) + Var\left(\overline{Y}\mid_{G=1,T=0}\right) + Var\left(\overline{Y}\mid_{G=1,T=1}\right) }.
\]</span></p>
<p>We can compute the second term. Each variance term is effectively just the squared SE of a conditional mean. Recall from earlier modules that this is computed simply as <code>varmean = var(X[G = g &amp; T = t], na.rm = TRUE) / sum(G = g &amp; T = t &amp; !is.na(X))</code>.</p>
<p>Finally, we need a distribution. Recall that, in only one case, the degrees of freedom are the straightforward <span class="math inline">\(df_{1} + df_{2} - 2\)</span>. In all other cases there is a specific formula that does not necessarily yield an integer DF. What do we then do here? There are two main options:</p>
<ol type="1">
<li><p>Assume that something analogous works for your situation as well, so that you compute your DF as <span class="math display">\[
df_{0,0} + df_{0,1} + df_{1,0} + df_{1,1} - 4.
\]</span></p></li>
<li><p>Ignore the DF and assume that you have sufficient variables (as a rule-of-thumb, do you have at least <span class="math inline">\(50\)</span> observations in each of the four groups?) so that you can assume that some Law of Large Numbers holds and therefore the distribution of the test statistic is approximately Normal.</p></li>
</ol>
<p>These give rise to the following procedure:</p>
<ol type="1">
<li>Compute <span class="math inline">\(\overline{Y}\mid_{G=1,T=1}\)</span>, <span class="math inline">\(\overline{Y}\mid_{G=1,T=0}\)</span>, <span class="math inline">\(\overline{Y}\mid_{G=0,T=1}\)</span>, <span class="math inline">\(\overline{Y}\mid_{G=0,T=0}\)</span>, <span class="math inline">\(Var\left(\overline{Y}\mid_{G=0,T=0}\right)\)</span>, <span class="math inline">\(Var\left(\overline{Y}\mid_{G=0,T=1}\right)\)</span>, <span class="math inline">\(Var\left(\overline{Y}\mid_{G=1,T=0}\right)\)</span>, and <span class="math inline">\(Var\left(\overline{Y}\mid_{G=1,T=1}\right)\)</span>.</li>
<li>Compute <span class="math inline">\(\theta = \left( \overline{Y}\mid_{G=1,T=1} - \overline{Y}\mid_{G=1,T=0} \right) - \left( \overline{Y}\mid_{G=0,T=1} - \overline{Y}\mid_{G=0,T=0} \right)\)</span>.</li>
<li>Compute <span class="math inline">\(s^{2} = \sqrt{ Var\left(\overline{Y}\mid_{G=0,T=0}\right) + Var\left(\overline{Y}\mid_{G=0,T=1}\right) + Var\left(\overline{Y}\mid_{G=1,T=0}\right) + Var\left(\overline{Y}\mid_{G=1,T=1}\right) }\)</span>.</li>
<li>Compute <span class="math inline">\(\frac{\theta}{s}\)</span> and label it either <span class="math inline">\(t\)</span> or <span class="math inline">\(z\)</span>.</li>
<li>If you used the <span class="math inline">\(t\)</span> label, compute <span class="math inline">\(N\mid_{G=0,T=0} + N\mid_{G=0,T=1} + N\mid_{G=1,T=0} + N\mid_{G=1,T=1} - 4\)</span> where <span class="math inline">\(N\)</span> means number of non-missing observations.</li>
<li>Compute the <span class="math inline">\(p\)</span> value for your test using either the <span class="math inline">\(t\)</span>-distribution or the Standard Normal distribution, depending on whether you used the <span class="math inline">\(t\)</span> or <span class="math inline">\(z\)</span> label respectively.</li>
</ol>
</section>
<section id="compute-the-2-times-2-table-of-means" class="level3">
<h3 class="anchored" data-anchor-id="compute-the-2-times-2-table-of-means">Compute the <span class="math inline">\(2 \times 2\)</span> Table of Means</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>sim.res.mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(wgt)) <span class="sc">%&gt;%</span> .<span class="sc">$</span>wgt <span class="sc">%&gt;%</span> mean, sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(wgt)) <span class="sc">%&gt;%</span> .<span class="sc">$</span>wgt <span class="sc">%&gt;%</span> mean, <span class="dv">0</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>      sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(wgt)) <span class="sc">%&gt;%</span> .<span class="sc">$</span>wgt <span class="sc">%&gt;%</span> mean, sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(wgt)) <span class="sc">%&gt;%</span> .<span class="sc">$</span>wgt <span class="sc">%&gt;%</span> mean, <span class="dv">0</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">3</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">3</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>sim.res.mat[<span class="dv">1</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> sim.res.mat[<span class="dv">1</span>,<span class="dv">2</span>] <span class="sc">-</span> sim.res.mat[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>sim.res.mat[<span class="dv">2</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> sim.res.mat[<span class="dv">2</span>,<span class="dv">2</span>] <span class="sc">-</span> sim.res.mat[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>sim.res.mat[<span class="dv">3</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> sim.res.mat[<span class="dv">2</span>,<span class="dv">1</span>] <span class="sc">-</span> sim.res.mat[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>sim.res.mat[<span class="dv">3</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> sim.res.mat[<span class="dv">2</span>,<span class="dv">2</span>] <span class="sc">-</span> sim.res.mat[<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>sim.res.mat[<span class="dv">3</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> sim.res.mat[<span class="dv">3</span>,<span class="dv">2</span>] <span class="sc">-</span> sim.res.mat[<span class="dv">3</span>,<span class="dv">1</span>]</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sim.res.mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'before'</span>, <span class="st">'after'</span>, <span class="st">'diff time'</span>)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sim.res.mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'no diet'</span>, <span class="st">'diet'</span>, <span class="st">'diff diet'</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sim.res.mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compute-the-variances-associated-with-each-group" class="level3">
<h3 class="anchored" data-anchor-id="compute-the-variances-associated-with-each-group">Compute the Variances Associated with each Group</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>sim.var.mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(wgt)) <span class="sc">%&gt;%</span> .<span class="sc">$</span>wgt <span class="sc">%&gt;%</span> var, sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(wgt)) <span class="sc">%&gt;%</span> .<span class="sc">$</span>wgt <span class="sc">%&gt;%</span> var,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>     sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(wgt)) <span class="sc">%&gt;%</span> .<span class="sc">$</span>wgt <span class="sc">%&gt;%</span> var, sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(wgt)) <span class="sc">%&gt;%</span> .<span class="sc">$</span>wgt <span class="sc">%&gt;%</span> var),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sim.var.mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'before'</span>, <span class="st">'after'</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sim.var.mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'no diet'</span>, <span class="st">'diet'</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sim.var.mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compute-the-counts-in-each-group" class="level3">
<h3 class="anchored" data-anchor-id="compute-the-counts-in-each-group">Compute the Counts in each Group</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>sim.n.mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(wgt)) <span class="sc">%&gt;%</span> .<span class="sc">$</span>wgt <span class="sc">%&gt;%</span> length, sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(wgt)) <span class="sc">%&gt;%</span> .<span class="sc">$</span>wgt <span class="sc">%&gt;%</span> length,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>     sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(wgt)) <span class="sc">%&gt;%</span> .<span class="sc">$</span>wgt <span class="sc">%&gt;%</span> length, sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> diet <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(wgt)) <span class="sc">%&gt;%</span> .<span class="sc">$</span>wgt <span class="sc">%&gt;%</span> length),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">byrow =</span> <span class="cn">TRUE</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sim.n.mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'before'</span>, <span class="st">'after'</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sim.n.mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'no diet'</span>, <span class="st">'diet'</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sim.n.mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compute-the-test-statistic" class="level3">
<h3 class="anchored" data-anchor-id="compute-the-test-statistic">Compute the Test Statistic</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>sim.theta <span class="ot">&lt;-</span> sim.res.mat[<span class="dv">3</span>,<span class="dv">3</span>] <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(sim.var.mat <span class="sc">/</span> sim.n.mat))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sim.theta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compute-the-p-value" class="level3">
<h3 class="anchored" data-anchor-id="compute-the-p-value">Compute the <span class="math inline">\(p\)</span>-Value</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'z-test'</span> <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(sim.theta), <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'t-test'</span> <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(<span class="fu">abs</span>(sim.theta), <span class="fu">sum</span>(sim.n.mat), <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="comparison-against-linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="comparison-against-linear-regression">Comparison Against Linear Regression</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>sim.data <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(wgt <span class="sc">~</span> Treatment <span class="sc">*</span> diet, <span class="at">data =</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summary-for-repeated-cross-section" class="level3">
<h3 class="anchored" data-anchor-id="summary-for-repeated-cross-section">Summary for Repeated Cross-Section</h3>
<p>Clearly, you can compute the DID estimator manually with repeated cross-section data and it yields estimates of similar quality to what OLS provides. If doing it manually is your preference, go ahead. Otherwise, you should also take away from this section that OLS works just as well for repeated cross-section data. The presentation of the manual method is really just to show you in detail how the underlying statistics of this estimator work.</p>
</section>
</section>
<section id="when-parallel-trends-fails" class="level2">
<h2 class="anchored" data-anchor-id="when-parallel-trends-fails">When Parallel Trends Fails</h2>
<p>The key and only assumption for DID is parallel trends:</p>
<p><span class="math display">\[
    \mathbb{E}[Y_{0,i}(0) \mid T_{i} = 1] - \mathbb{E}[Y_{0,i}(0) \mid T_{i} = 0] = \mathbb{E}[Y_{1,i}(0) \mid T_{i} = 1] - \mathbb{E}[Y_{1,i}(0) \mid T_{i} = 0].
\]</span></p>
<p>What happens if this fails? Notice what happens to the bias when you compute the DID estimator,</p>
<p><span class="math display">\[
    \theta - ATET = \underbrace{\left( \mathbb{E}[Y_{1,i}(0) \mid T_{i} = 1] - \mathbb{E}[Y_{1,i}(0) \mid T_{i} = 0] \right)}_{\text{Time Trend for $G_{i} = 1$}} - \underbrace{\left( \mathbb{E}[Y_{0,i}(0) \mid T_{i} = 1] - \mathbb{E}[Y_{0,i}(0) \mid T_{i} = 0] \right)}_{\text{Time Trend for $G_{i} = 0$}}.
\]</span></p>
<p>When parallel trends is not satisfied, there is no longer any guarantee that the trends for the two groups are in the same direction, such that DID reduces the bias in the estimator. In fact, if the two groups intuitively trend in opposite directions, DID exacerbates the bias. Can you think of situations where your treated and never-treated groups naturally trend in different directions over time?</p>
<section id="load-data-2" class="level3">
<h3 class="anchored" data-anchor-id="load-data-2">Load Data</h3>
<p>Let’s take a look at some data where parallel trends fails.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">998</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">i =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>), <span class="at">hgt =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="fl">1.63</span>, <span class="fl">0.08</span>), <span class="at">u =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">diet =</span> <span class="fu">if_else</span>(<span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>sim.data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Treatment =</span> <span class="dv">0</span>, <span class="at">e =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wgt =</span> <span class="dv">28</span> <span class="sc">*</span> hgt <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> e),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    sim.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Treatment =</span> <span class="dv">1</span>, <span class="at">e =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span> u, <span class="at">hgt =</span> <span class="fu">if_else</span>(diet <span class="sc">==</span> <span class="dv">1</span>, hgt <span class="sc">-</span> .<span class="dv">1</span>, hgt <span class="sc">+</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wgt =</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">28</span> <span class="sc">*</span> hgt <span class="sc">^</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">3</span> <span class="sc">*</span> diet <span class="sc">+</span> e)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sim.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-t-test-fails" class="level3">
<h3 class="anchored" data-anchor-id="the-t-test-fails">The <span class="math inline">\(t\)</span>-Test Fails</h3>
<p>Intuitively, because the divergence in time trends is due to unaccounted-for changes in other covariates, the <span class="math inline">\(t\)</span>-test will be badly biased because it is not considering the possibility that other confounding factors may change differently between the groups over time. This again reflects the core intuition of the parallel trends assumption: the selection bias in treatment assignment has to be constant over time.</p>
<p>In this case, because the time trends of the diet and non-diet group move in opposite directions, the simple DID (first row) is more biased than either the naïve comparison measure (second row) or the before-after estimator (third row).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>diff.data <span class="ot">&lt;-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">-</span> sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">diet =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">t.test</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>        diff.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(diet <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt),</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>        diff.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(diet <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt),</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">var.equal =</span> <span class="cn">TRUE</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">t.test</span>(</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>        sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">1</span>, diet <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt),</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>        sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">1</span>, diet <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt),</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">var.equal =</span> <span class="cn">TRUE</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">t.test</span>(</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>        sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">1</span>, diet <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt),</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>        sim.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Treatment <span class="sc">==</span> <span class="dv">0</span>, diet <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(wgt),</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">var.equal =</span> <span class="cn">TRUE</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_df</span>(tidy) <span class="sc">%&gt;%</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    print</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-regression-method-still-works" class="level3">
<h3 class="anchored" data-anchor-id="the-regression-method-still-works">The Regression Method Still Works</h3>
<p>As we will see below, the regression method with controls still obtains the desired estimate. In fact, the OLS estimator gets the correct estimate despite misspecifying how height enters the model. This really gets to the heart of how closely linked regression methods (not just linear regression) and the CEF are. Notice that the regression model with controls is really estimating this:</p>
<p><span class="math display">\[
    ATET = \left( \mathbb{E}[Y_{i} \mid X_{i}, G_{i} = 1, T_{i} = 1] - \mathbb{E}[Y_{i} \mid X_{i}, G_{i} = 1, T_{i} = 0] \right) - \left( \mathbb{E}[Y_{i} \mid X_{i}, G_{i} = 0, T_{i} = 1] - \mathbb{E}[Y_{i} \mid X_{i}, G_{i} = 0, T_{i} = 0] \right).
\]</span></p>
<p>If controls <span class="math inline">\(X_{i}\)</span> are good enough proxies for the true reasons (or are the true reasons themselves) for divergence in time trends between the treated and never-treated groups, then the conditional version of the parallel trends assumption will be satisfied:</p>
<p><span class="math display">\[
    \mathbb{E}[Y_{0,i}(0) \mid X_{i}, T_{i} = 1] - \mathbb{E}[Y_{0,i}(0) \mid X_{i}, T_{i} = 0] = \mathbb{E}[Y_{1,i}(0) \mid X_{i}, T_{i} = 1] - \mathbb{E}[Y_{1,i}(0) \mid X_{i}, T_{i} = 0].
\]</span></p>
<p>This brings out the intuition for doing DID estimation with regression models. What you seek to control for is not selection bias—remember that DID has no problem with time-invariant selection bias. Instead, controls in the DID model should remove differences in the time trends of the treated and never-treated groups. This is what you need discuss when setting up your DID model and justifying the controls used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> diet, <span class="at">data =</span> <span class="fu">filter</span>(sim.data, Treatment <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment, <span class="at">data =</span> <span class="fu">filter</span>(sim.data, diet <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">+</span> diet, <span class="at">data =</span> sim.data)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>model4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> hgt <span class="sc">+</span> Treatment <span class="sc">*</span> diet, <span class="at">data =</span> sim.data)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>model5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wgt <span class="sc">~</span> Treatment <span class="sc">*</span> diet, <span class="at">data =</span> sim.data)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(model1, </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>          model2, </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>          model3, </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>          model4, </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>          model5, </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">'text'</span>,</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">df =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">omit.stat =</span> <span class="fu">c</span>(<span class="st">'F'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="exercise-difference-in-differences-in-your-project" class="level2">
<h2 class="anchored" data-anchor-id="exercise-difference-in-differences-in-your-project">Exercise #: Difference-in-Differences in your Project</h2>
<section id="load-your-data" class="level3">
<h3 class="anchored" data-anchor-id="load-your-data">Load Your Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>my.data <span class="ot">&lt;-</span> <span class="st">'load your data'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>my.data <span class="ot">&lt;-</span> <span class="st">'clean your data'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>my.data <span class="sc">%&gt;%</span> data.frame <span class="sc">%&gt;%</span> <span class="fu">stargazer</span>(<span class="at">type =</span> <span class="st">'text'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plan-and-run-some-dd-models" class="level3">
<h3 class="anchored" data-anchor-id="plan-and-run-some-dd-models">Plan and Run some DD Models</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>my.model<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="st">'write your model'</span> <span class="sc">%&gt;%</span> <span class="fu">lm</span>(, <span class="at">data =</span> my.data)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>my.model<span class="fl">.1</span> <span class="sc">%&gt;%</span> summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>my.model<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="st">'write another model'</span> <span class="sc">%&gt;%</span> <span class="fu">lm</span>(, <span class="at">data =</span> my.data)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>my.model<span class="fl">.2</span> <span class="sc">%&gt;%</span> summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>my.model<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="st">'write as many models as you would like to estimate'</span> <span class="sc">%&gt;%</span> <span class="fu">lm</span>(, <span class="at">data =</span> my.data)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>my.model<span class="fl">.3</span> <span class="sc">%&gt;%</span> summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tabulate-all-models" class="level3">
<h3 class="anchored" data-anchor-id="tabulate-all-models">Tabulate All Models</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    my.model<span class="fl">.1</span>,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    my.model<span class="fl">.2</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    my.model<span class="fl">.3</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">'html'</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">out =</span> <span class="st">'prj_dd_out.html'</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">out.header =</span> <span class="cn">TRUE</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../../../docs/4_Advanced/advanced_classification_and_clustering/advanced_classification_and_clustering.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Classification and Clustering</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../docs/4_Advanced/advanced_geospatial/advanced_geospatial.html" class="pagination-link">
        <span class="nav-page-text">Geospatial I</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png"></a>.  <a rel="license" href="https://comet.arts.ubc.ca/pages/copyright.html">See details.</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 The COMET Project and the UBC Vancouver School of Economics are located on the traditional, ancestral and unceded territory of the xʷməθkʷəy̓əm (Musqueam) and Sḵwx̱wú7mesh (Squamish) peoples.
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>