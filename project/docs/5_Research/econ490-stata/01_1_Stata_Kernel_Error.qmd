---
title: '01.1 - Common Stata_Kernel Error'
author: Alex Ronczewski 
date: 2025-01-19
description: This notebook will solve a common error when installing the stata_kernel. 
categories: [econ 490, stata, setting up, intro]
format: 
  html: default
  ipynb:
      syntax-definitions: 
      - stata.xml
      kernelspec: 
        display_name: Stata
        language: Stata
        name: stata
---

## Prerequisites 

1. Have installed Stata onto your personal computer.
2. Have installed Anaconda Navigator onto your personal computer.
3. Have followed the instructions in 01 - Jupyter and Stata. 

## Outcome 

The only outcome of this notebook is to fix the error which occurs when you run

```bash
  python -m stata_kernel.install
```

The correct output is `Installing Jupyter kernel spec`, if this is the output you see then you do not have an issue and can move on to the next notebook, but if what pops up is `Cannot import kernel Installing Jupyter kernel spec` then you have an error and stata_kernel will not work. More information about this error can be found on this [Github Post](https://github.com/kylebarron/stata_kernel/issues/376). This is a common issue which arises from the main Stata application/exe being installed in a place where stata_kernel does not expect it. 

This notebook will be a step by step guide for both Mac and Windows to solve this issue. First we will cover Mac (All sections starting with 1.X) and then in the lower section we will cover Windows (Sections starting with 2.X). The steps are very similar, but because of OS differences some steps will be different. 

## 1.0 Mac 

Below we will show steps for Mac if you have a Windows computer scroll down to section **2.0**

#### 1.1 Browing all files on Mac

In order to follow this guide you must be able to browse all of your files. 

1. Click anywhere on the desktop to ensure Finder is active in the menu bar.
2. Go to the top menu bar and click on "Finder" > "Settings" (or "Preferences" in older macOS versions)
3. In the Finder Settings window, select the "General" tab.
4. Under the "Show these items on the desktop" section, check the box next to "Hard disks"
5. Close the Settings window.
6. You may also need to restart your computer for the change to take place

#### 1.2 Find the path to your Stata app

1. Open your new hard drive icon on your desktop 

![Macintosh HD logo on Desktop](images_for_stata_kernel_qmd/Macintosh-HD.png)

2. Navigate to the Stata installation 
3. Write down to path for the Stata Installation it should look similar to `/Applications/Stata/StataSE.app/Contents/MacOS/StataSE`
4. **Write this path down and save it for later you will need it. Also make sure it is case sensitive as macOS is case sensitive.**

#### 1.3 Show hidden files and folders on Mac

1. Open Terminal from the Applications -> Utilities folder. (Or Command + Space and type in Terminal).
2. Type in the following command 

```bash
defaults write com.apple.Finder AppleShowAllFiles YES
```
3. Now restart you computer for the change to take place

You will now be able to see all folders including the hidden ones like your OS and other things that Mac doesent show by default. Most importantly the /usr/local/opt folder where by default the anaconda3 instalation is. 

More information about this step can be found in this [Article](https://macpaw.com/how-to/access-opt-folder-on-mac). 

<div class="alert alert-info">

**Note:** Being able to see all files on Mac is needed for this fix, but does have some risks. If you are an inexperienced user then exposing hidden folders system-wide could potentially lead to accidental modifications of important system files if you're not careful. </div>

4. If you wish to disable seeing hidden files after the fix is completed it is simple. After you reach the end of the Mac section and see that stata_kernel now works. Type in the following command into your termianal

```bash
defaults write com.apple.Finder AppleShowAllFiles NO
```
After you type in the command restart your computer, you now will have returned to not being able to see all files. 


#### 1.4 Navigate to your Anaconda3 Installation 

1. There are all kinds of commands which can be ran in the terminal (Command + Space) to find the path for the Anaconda installation some examples are 
```bash
which conda
conda info --base
whereis conda
```
They will show where your Anaconda installation is 

2. Once you have the path follow it by clicking on Macintosh HD on your desktop and going to it. The path will look similar to `/opt/anaconda3/envs/stata_r_env/lib/python3.x/site-packages/stata_kernel`. The x in python3 will be the version number of Python. 

3. Once inside of the stata_kernel folder open `config.py` to do this you will need a code editor. Some free options are Sublime Text, VSCode, or Brackets just choose one which is simple and then open the file.   
4. Once the file is open replace the value of the variable `stata_path` with your stata path which you wrote down earlier. 

The code which you are looking for is on line 84 

```python
stata_path = r'PASTE YOUR PATH TO STATA FROM EARLIER BETWEEN THE APOSTROPHE’
        if not stata_path:
            self.raise_config_error('stata_path')
```

After editing it make sure that 
  - **r’ ahead of the apostrophe is intact and don't change anything else**

5. Save and close the file. 

#### 1.4.1 An alternate approach to finding your Anaconda3 Installation (and the config.py file)

If this did not work you could also search for config.py in spotlight search (Command + Space). This approach can also work, but will depend on how many applications you have installed on your computer as many applications will have a config.py file. If you do this **make sure that it is the correct one for stata_kernel by looking at the red square at the bottom of finder and seeing if it is in the correct path.** The path should look like `/opt/anaconda3/envs/stata_r_env/lib/python3.x/site-packages/stata_kernel`. Just without the slashes and with nice folder icons. 

![Finder File Path on Mac](images_for_stata_kernel_qmd/Finder-Show-Path-Bar.jpg)

#### 1.5 Find your .stata_kernel.conf file and edit it

1. You should be able to find this file using spotlight search (Command + Space), you will again need a code editor to open the file. 
2. Once inside, change the variable stata_path to be equal to the path to the main Stata installation which you saved earlier
3. Line 2 of the file will look like 

```bash
stata_path = YOUR PATH HERE
```
**This time do not include 'r and apostrophes. Except for the stata_path do not change anything else**. 

4. Save and close the file

#### 1.6 Seeing if it worked. 
1. Open Terminal (Command + Space and type in Terminal). 
2. Type in 
```bash
conda activate stata_r_env 
```

![Environments in Terminal](images_for_stata_kernel_qmd/env_anaconda.png)

You will see on the left that you are now in the environment called (stata_r_env) this means it worked. The difference is **the terminal will look different as it a white Mac terminal**. 

3. Once that is done type in 
```bash
python -m stata_kernel.install
```
and the output message should be. `Installing Jupyter kernel spec`. This means it worked and you are done. 

4. If the output is `Cannot import kernel, Installing Jupyter kernel spec`. Then something went wrong in the process. Look back throught this notebook or look at the Github post referenced earlier. 
5. If you want to open a local jupyter notebook use the command
```bash
jupyter notebook
```

## 2.0 Windows

Below is the section for a Windows computer.

#### 2.1 Finding your path to the main Stata installation 
1. In the file explorer find your path to the .exe file for Stata. The path should look like `C:\Program Files\Stata18\Stata-SE64.exe`. Write it down and save it for later.

**Important: Do not type Stata into your windows search and right click on it and select `open file location` this will not be the correct path.**

The path will most likely be the folder `Program Files` under your default drive. 

#### 2.2 Navigate to your Anaconda3 Installation 
1. Open your file explorer and look for your Anaconda3 installation
2. If you are unsure where to look you can run the command below in the anaconda prompt (this can be opened by clicking the windows key and typing in anaconda prompt)
```bash
conda info --base
```
which will have as an output where the Anaconda3 installation is. 

3. Inside of the Anaconda path find the path to the stata_kernel, the path should look like `D:\Users\USERNAME\anaconda3\envs\stata\Lib\site-packages\stata_kernel`
4. Inside open the config.py file, you can do this using notepad. You do not need any new programs to open this file.

#### 2.3 How to open a .py file using notepad
1. Right-click on the config.py file. 
2. Select "Open with" from the context menu.
3. Choose "Notepad" from the list of available programs.

4. If Notepad isn't listed as an option: Click on "Choose another app" or "More apps".
6. Scroll down and click on "Notepad" if you see it, or select "Look for another app on this PC". Navigate to C:\Windows and select "notepad.exe".

#### 2.4 Editing the file itself 

1. Once the file is open replace the value of the variable `stata_path` with your stata path which you wrote down earlier. It should look similar to `C:\Program Files\Stata18\Stata-SE64.exe`

The code which you are looking for is on line 84 

```python
stata_path = r'PASTE YOUR PATH TO STATA FROM EARLIER BETWEEN THE APOSTROPHE’
        if not stata_path:
            self.raise_config_error('stata_path')
```

After editing it make sure that 
  - **r’ ahead of the apostrophe is intact and don't change anything else**

2. Save and close the file. 


#### 2.5 Finding and editing the .stata_kernel.conf

1. Under your users directory look for the .stata_kernel.conf, you can also search for it using the search function within file explorer. 
2. Open the file using notepad the same way as with the config.py file. If you do not remember how to do this you can follow the instructuons in **Section 2.3**
3. Once inside, change the variable stata_path to be equal to the path to the main Stata installation which you saved earlier
Line 2 of the file will look like 

```bash
stata_path = YOUR PATH HERE
```
**This time do not include 'r and apostrophes. Except for the stata_path do not change anything else**. 

4. Save and close the file 

#### 2.6 Seeing if it worked. 
1. Open Anaconda Prompt. 
2. Type in 
```bash
conda activate stata_r_env 
```

![Environments in Anaconda Prompt](images_for_stata_kernel_qmd/env_anaconda.png)

You will see on the left that you are now in the environment called (stata_r_env) this means it worked. 

3. Once that is done type in 
```bash
python -m stata_kernel.install
```
and the output message should be. `Installing Jupyter kernel spec`. This means it worked and you are done. 

4. If the output is `Cannot import kernel, Installing Jupyter kernel spec`. Then something went wrong in the process. 
5. If you want to open a local jupyter notebook use the command
```bash
jupyter notebook
```

## 3. Conclusion 

This should solve the common issue of having the `Cannot import kernel Installing Jupyter kernel spec` error message when trying to install stata_kernel. 
